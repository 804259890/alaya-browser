<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platon.browser.persistence.dao.mapper.AddStakingMapper">
    <update id="addStaking" parameterType="com.platon.browser.persistence.dao.param.AddStakingParam">
	update `staking`  set
		`staking_has` = `staking_has` + #{amount}
	where
		`node_id` = #{nodeId}
	and
		`staking_block_num` = #{stakingBlockNum};

	update `node` set
		`total_value` = `total_value` + #{amount},
		`staking_has` = `staking_has` + #{amount}
	where
		`node_id` = #{nodeId};

	insert into `node_opt`
		(`node_id`,
		`type`,
		`tx_hash`,
		`b_num`,
		`time`
		)
	values
		(#{nodeId},
		'2',
		#{txHash},
		#{bNum},
		#{time}
		);

  </update>
</mapper>